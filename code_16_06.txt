'*****************************************
'Nom : Dubuis Vncent
'But : Création d'une page de plan horaire annuel automatiquement
'*****************************************
' Crée le : 02 juin 2017
'*****************************************
Sub ecritDeBase()

'**********************************************************************
'Variable :

    '-----Création des constante
    
    '-----Création des variables
    
    'On récupère la valeur du premier jour de l'année
    Dim valueDayOfYear
    'Tableau contennant les mois de l'années
    Dim tabArrayMonth()
    'Nombre de jour dans le mois
    Dim daysInTheMonth
    'Variable récupérant le jour de la semaine
    Dim dayOfTheWeek
    
    'Je donne des valeur pour les variables.
    tabArrayMonth = Array("Janvier", "Février", "Mars", "Avril", "Mai", "Juin", "Juillet", "Août", "Septembre", "Octobre", "Novembre", "Décembre")
    'Je récupère la valeur du premier jour de l'année.
        Range("G1").Select
        ActiveCell.FormulaR1C1 = "=DATE(RC[-1],1,1)"
        Range("H1").Select
        ActiveCell.FormulaR1C1 = Range("G1").Value
        Selection.NumberFormat = "General"
        valueDayOfYear = Range("H1").Value
        Range("G1:H1").Select
        Selection.ClearContents
    
    
    
'**********************************************************************
    
    'Boucle qui crée une feuille et la renomme par rapport à un mois.
    For i = 0 To 11
    
        '----- Création  des feuilles.
    
        'Création d'une feuille
        Sheets.Add After:=ActiveSheet
        'Le nom de la feuille est déterminé par la valeur de la variable "month" qui change à chaque boucle.
        ActiveSheet.Name = tabArrayMonth(i)
    
        '------ Inscription des données non-dynamique dans la feuille.
    
        'Le nom devra être dynamique quand ce sera à l'admin d'entrer le nom dans son Excel. Je récupérerai l'info dans une cellule.
        Range("A1").Select
        ActiveCell.FormulaR1C1 = "Dubuis Vincent"
        
        Range("C2").Select
        ActiveCell.FormulaR1C1 = "Début matin"
        Range("D2").Select
        ActiveCell.FormulaR1C1 = "Fin matin"
        Range("E2").Select
        ActiveCell.FormulaR1C1 = "Début après-midi"
        Range("F2").Select
        ActiveCell.FormulaR1C1 = "Fin après-midi"
        Range("H2").Select
        ActiveCell.FormulaR1C1 = "Nombre d'heures du jour"
        Columns("A:I").Autofit
        
        
        
        '------ Inscription des dates
        
        'La colonne B est entièrement en format DATE. On y entrera les dates sous le format numérique.
        
        'Ex :   J'entre 40777 et cela me sortirait 22 août 2011. On a qu'à faire +1 à chaque retour
        '       à la ligne et le nombre de retour à la ligne dépend du nombre de jour dans le mois.
        
        
        Columns("B:B").Select
        'Je change le format en date mais plus précisement avec le jour de la semaine en plus.
        Selection.NumberFormat = "[$-x-sysdate]dddd, mmmm dd, yyyy"
        
        '-
        'Cela ne marche pas
        
    'Select Case i
        ' Case Is = 0
        ' daysInTheMonth = 30
        ' Case Is = 2
        ' daysInTheMonth = 30
        ' Case Is = 4
        ' daysInTheMonth = 30
        ' Case Is = 6
        ' daysInTheMonth = 30
        ' Case Is = 7
        ' daysInTheMonth = 30
        ' Case Is = 9
        ' daysInTheMonth = 30
        ' Case Is = 11
        ' daysInTheMonth = 30
        ' Case Is = 1
        ' daysInTheMonth = 27
        ' Case Else
        ' daysInTheMonth = 29
    
    ' End Select
        
      '  If (daysInTheMonth = 27) Then
      '      If (yearWhished Mod 4 = 0 And yearWished Mod 100 > 0) Then
      '      daysInTheMonth = 28
      '      Else
      '      End If
    ' End If
        '-
        
        'On note la première date du mois.
        Range("B3").Select
        ActiveCell.FormulaR1C1 = valueDayOfYear
        
        'Dès qu'on sait la date, on sait également le mois et l'année. Je note une formule qui m'indique
        'le jour dans le mois (années bissextiles comprises)
        Range("A2").Select
        'Formule
        ActiveCell.FormulaR1C1 = "=DAY(DATE(YEAR(R[1]C[1]),MONTH(R[1]C[1])+1,1)-1)"
        'Je récupère la valeur pour la boucle qui va suivre, nous aurons la valeur du nombre de jours..
        daysInTheMonth = Range("A2").Value
        'J'efface la formule, mais conserve la valeur.
        Selection.ClearContents
        
        'Cette boucle fait inscrire les dates dans la colonne selon le nombre de jours dans le mois qu'on a récupérer juste avant.
        
        For j = 1 To daysInTheMonth
            'On note la valeur de la date dans une cellule donnée en fonction de j dans la colonne B
            Cells(j + 2, 2) = valueDayOfYear
            'Récupère le jour de la semaine dans une variable et écrit à gauche quelle jour de la semaine, on est.
            'Pour une raison encore inconnu je dois faire -1 au numéro de jour pour avoir les bons jour.
            dayOfTheWeek = Weekday(valueDayOfYear - 1)
            Cells(j + 2, 1) = dayOfTheWeek
            If (dayOfTheWeek = 6) Then
            
                Range(Cells(j + 2, 3), Cells(j + 2, 6)).Select
            
                With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    .ThemeColor = xlThemeColorDark1
                    .TintAndShade = -0.249977111117893
                    .PatternTintAndShade = 0
                End With
                
            End If
            If (dayOfTheWeek = 7) Then
            
                Range(Cells(j + 2, 3), Cells(j + 2, 6)).Select
            
                With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    .ThemeColor = xlThemeColorDark1
                    .TintAndShade = -0.249977111117893
                    .PatternTintAndShade = 0
                End With
                
            End If
            
            Range("H3").Select
            ActiveCell.FormulaR1C1 = "=(RC[-4]-RC[-5])+(RC[-2]-RC[-3])"
            Selection.AutoFill Destination:=Range(Cells(3, 8), Cells(daysInTheMonth + 2, 8)), Type:=xlFillDefault
            Range(Cells(8, 3), Cells(8, daysInTheMonth + 2)).Select
            
            'Jour suivant
            valueDayOfYear = valueDayOfYear + 1
            
            
        Next
        
        Range(Cells(2, 1), Cells(daysInTheMonth + 2, 6)).Select
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideVertical)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
        
        
        'On redimensionne la colonne B, car sinon les dates apparaissent comme cela : ########
        Columns("B:B").Autofit
        Columns("H:H").Select
        Selection.NumberFormat = "hh/mm"" h"";@"
        Cells(daysInTheMonth + 4, 7).Select
        ActiveCell.FormulaR1C1 = "Nombre d'heure dans le mois"
        test = -daysInTheMonth
        Cells(daysInTheMonth + 4, 8).Select
        ActiveCell.FormulaR1C1 = "=SUM(R[ " + test + " -4]C:R[-4]C)"
        
        Columns("G:G").Autofit
        
        Cells(1, 1).Select
        
    Next
    
    
'**********************************************************************
'Optionnel :
        '
        'actualDate = Date
        'actualYear = Year(actualDate)
        'Range("A2").Select
        'ActiveCell.FormulaR1C1 = actualYear
        'Range("A3").Select
        'ActiveCell.FormulaR1C1 = Date
        'Range("B2").Select
        'ActiveCell.FormulaR1C1 = yearWished
End Sub

